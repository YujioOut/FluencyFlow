<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vocabulary Table</title>
    <style>
      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
      }
      table,
      th,
      td {
        border: 1px solid black;
      }
      th,
      td {
        padding: 8px;
        text-align: center;
        width: 10%; /* Ensure it's a 10x10 grid */
        word-wrap: break-word;
        height: 80px; /* Adjust height for readability */
      }
      td {
        cursor: pointer;
      }
      .selected {
        background-color: lightgreen;
      }

      /* Button container for top-right positioning */
      .button-container {
        position: fixed;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
      }

      /* Style for buttons */
      .next-button,
      .study-button,
      .prev-button,
      .reset-button,
      .toggle-romaji-button {
        padding: 10px 20px;
        font-size: 16px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .next-button:hover,
      .prev-button:hover,
      .study-button:hover,
      .reset-button:hover,
      .toggle-romaji-button:hover {
        background-color: #45a049;
      }
    </style>
  </head>
  <body>
    <h1>Vocabulary Table (10x10 Grid)</h1>
    <table id="vocabTable">
      <thead>
        <tr>
          <th>Kanji</th>
          <th>Kana</th>
          <th>English</th>
          <th>Kanji</th>
          <th>Kana</th>
          <th>English</th>
          <th>Kanji</th>
          <th>Kana</th>
          <th>English</th>
          <th>Kanji</th>
        </tr>
      </thead>
      <tbody>
        <!-- Data will be populated here -->
      </tbody>
    </table>

    <div class="button-container">
      <button class="study-button" id="studyButton">Study Mode</button>
      <button class="prev-button" id="prevButton">Previous</button>
      <button class="next-button" id="nextButton">Next</button>
      <button class="reset-button" id="resetButton">Reset</button>
      <button class="toggle-romaji-button" id="toggleRomajiButton">
        Toggle Romaji
      </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
      let currentIndex = 0; // Keeps track of the current index of the CSV data
      let selectedItems =
        JSON.parse(localStorage.getItem("selectedItems")) || {}; // Stores selected items across pages
      let isStudyMode = false; // Tracks if we're in study mode
      let showRomaji = true; // Flag to control whether Romaji is shown

      // Load the CSV file
      fetch("vocab_list.csv")
        .then((response) => response.text())
        .then((csvText) => {
          // Parse the CSV content
          const parsedData = Papa.parse(csvText, { header: true }).data;

          // Function to render the data
          const renderTable = () => {
            const tableBody = document.querySelector("#vocabTable tbody");
            tableBody.innerHTML = ""; // Clear the table

            // Slice the data to show only the next 100 entries
            const dataToDisplay = parsedData.slice(
              currentIndex,
              currentIndex + 100
            );
            const dataToDisplayForStudy = Object.keys(selectedItems).map(
              (id) => parsedData[id]
            );

            const dataToShow = isStudyMode
              ? dataToDisplayForStudy
              : dataToDisplay;

            dataToShow.forEach((entry, index) => {
              // Create a new row every 10th word
              if (index % 10 === 0) {
                row = document.createElement("tr");
                tableBody.appendChild(row);
              }

              // Create a table cell for Kanji, Kana, and English definition
              const td = document.createElement("td");
              td.innerHTML = `${entry.Kanji}<br>${entry.Kana}<br>${
                entry.English
              }<br>${showRomaji ? entry.Romaji : ""}`;

              // If this item is selected, make it green
              const entryId = currentIndex + index;
              if (selectedItems[entryId]) {
                td.classList.add("selected");
              }

              td.addEventListener("click", () => {
                // Toggle the selection
                td.classList.toggle("selected");
                if (td.classList.contains("selected")) {
                  selectedItems[entryId] = entry; // Save the selected entry
                } else {
                  delete selectedItems[entryId]; // Remove from selected items
                }

                // Save to localStorage
                localStorage.setItem(
                  "selectedItems",
                  JSON.stringify(selectedItems)
                );
              });

              row.appendChild(td);
            });
          };

          // Initial render
          renderTable();

          // Add event listener for the Next button
          document
            .getElementById("nextButton")
            .addEventListener("click", () => {
              if (currentIndex + 100 < parsedData.length) {
                currentIndex += 100; // Move to the next 100 items
                renderTable(); // Re-render the table with the new data
              } else {
                alert("No more data to display.");
              }
            });

          // Add event listener for the Previous button
          document
            .getElementById("prevButton")
            .addEventListener("click", () => {
              if (currentIndex - 100 >= 0) {
                currentIndex -= 100; // Move to the previous 100 items
                renderTable(); // Re-render the table with the new data
              } else {
                alert("You're already at the beginning of the data.");
              }
            });

          // Add event listener for the Study button
          document
            .getElementById("studyButton")
            .addEventListener("click", () => {
              isStudyMode = !isStudyMode; // Toggle study mode
              document.getElementById("studyButton").textContent = isStudyMode
                ? "Show All"
                : "Study Mode"; // Update button text
              renderTable(); // Re-render the table
            });

          // Add event listener for the Reset button
          document
            .getElementById("resetButton")
            .addEventListener("click", () => {
              localStorage.removeItem("selectedItems"); // Clear localStorage
              selectedItems = {}; // Reset selectedItems
              renderTable(); // Re-render the table
            });

          // Add event listener for the Romaji toggle button
          document
            .getElementById("toggleRomajiButton")
            .addEventListener("click", () => {
              showRomaji = !showRomaji; // Toggle the Romaji visibility
              renderTable(); // Re-render the table
            });
        })
        .catch((error) => console.error("Error loading the CSV file: ", error));
    </script>
  </body>
</html>
